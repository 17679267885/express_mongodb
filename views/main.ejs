<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <title>主页</title>
  <link rel="stylesheet" href="./css/shopping.css">
</head>

<body>
  <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <div class="cartTitle pull-right">
    <span>已选商品 (不含运费)</span>
    <span id="cartTitlePrice" class="cartTitlePrice">￥0.00</span>
    <button class="createOrderButton" style="background-color: rgb(170, 170, 170);" disabled="disabled">结 算</button>
  </div>
  <div class="cartProductList">
    <table class="cartProductTable">
      <thead>
        <tr>
          <th class="selectAndImage">
            <img src="./images/cartNotSelected.png" class="selectAllItem" selectit="false">
            全选
          </th>
          <th>商品信息</th>
          <th>单价</th>
          <th>数量</th>
          <th width="120px">金额</th>
          <th class="operation">操作</th>
        </tr>
      </thead>
      <tbody>

        <tr>
          <td>
            <div class="shopId"><img src="./images/cartNotSelected.png" class="selectAllItem" selectit="false">
              <img src="./images/logo.png" width="30" height="20">
              <a href="#nowhere">店铺：TT官方旗舰店</a>

            </div>
          </td>
        </tr>

        <tr class="cartProductItemTR" oiid="936">
          <td>
            <img src="./images/cartNotSelected.png" class="cartProductItemIfSelected" oiid="936" selectit="false">
            <a href="#nowhere" style="display:none"><img src="./images/cartSelected.png"></a>
            <img src="./images/p60.jpg" class="cartProductImg">
          </td>
          <td>
            <div class="cartProductLinkOutDiv">
              <a class="cartProductLink" href="#nowhere">【12期免息】Huawei/华为P70 Pro麒麟系列四摄变焦智能手机</a>
            </div>
          </td>
          <td>
            <span class="cartProductItemPromotionPrice">￥6988.00</span>
          </td>
          <td>
            <div class="cartProductChangeNumberDiv">
              <span pid="365" class="hidden orderItemStock ">75</span>
              <span pid="365" class="hidden orderItemPromotePrice ">6988.0</span>
              <a href="#nowhere" class="numberMinus" pid="365">-</a>
              <input value="1" autocomplete="off" class="orderItemNumberSetting" oiid="936" pid="365">
              <a href="#nowhere" class="numberPlus" pid="365" stock="75">+</a>
            </div>
          </td>
          <td>
            <span pid="365" oiid="936" id="cartProductItemSmallSumPrice" class="cartProductItemSmallSumPrice">
              ￥6988.00
            </span>
          </td>
          <td>
            <a href="#nowhere" oiid="936" class="deleteOrderItem">删除</a>
          </td>
        </tr>
        <tr class="cartProductItemTR" oiid="935" style="background-color: rgb(255, 255, 255);">
          <td>
            <img src="./images/cartNotSelected.png" class="cartProductItemIfSelected" oiid="935" selectit="false">
            <a href="#nowhere" style="display:none"><img src="./images/cartSelected.png"></a>
            <img src="./images/vue.jpg" class="cartProductImg">
          </td>
          <td>
            <div class="cartProductLinkOutDiv">
              <a class="cartProductLink" href="#nowhere">正版 VUE.3.0框架 组合式API 编程教程 VUE3.0从入门到精通 程序框架教材
              </a>
            </div>
          </td>
          <td>
            <span class="cartProductItemOringalPrice">￥59.48</span>
            <span class="cartProductItemPromotionPrice">￥43.80</span>
          </td>
          <td>
            <div class="cartProductChangeNumberDiv">
              <span pid="809" class="hidden orderItemStock ">17</span>
              <span pid="809" class="hidden orderItemPromotePrice ">43.80</span>
              <a href="#nowhere" class="numberMinus" pid="809">-</a>
              <input value="1" autocomplete="off" class="orderItemNumberSetting" oiid="935" pid="809">
              <a href="#nowhere" class="numberPlus" pid="809" stock="17">+</a>
            </div>
          </td>
          <td>
            <span pid="809" oiid="935" id="cartProductItemSmallSumPrice" class="cartProductItemSmallSumPrice">
              ￥43.80
            </span>
          </td>
          <td>
            <a href="#nowhere" oiid="935" class="deleteOrderItem">删除</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="cartFoot">
    <img src="./images/cartNotSelected.png" class="selectAllItem" selectit="false">
    <span>全选</span>
    <!--         <a href="#">删除</a> -->
    <div class="pull-right">
      <span>已选商品 <span id="cartSumNumber" class="cartSumNumber">0</span> 件</span>
      <span>合计 (不含运费): </span>
      <span id="cartSumPrice" class="cartSumPrice">￥0.00</span>
      <button class="createOrderButton" style="background-color: rgb(170, 170, 170);" disabled="disabled">结 算</button>
    </div>
  </div>
  <script>
    $(function () {
      //点击产品选择框
      $("img.cartProductItemIfSelected").click(function () {
        var selectit = $(this).attr("selectit");
        if ("selectit" == selectit) {
          $(this).attr("src", "./images/cartNotSelected.png");
          $(this).attr("selectit", "false")
          $(this).parents("tr.cartProductItemTR").css("background-color", "#fff");
          syncSelect();
          syncCreateOrderButton();
          removePrice();
        }
        else {
          $(this).attr("src", "./images/cartSelected.png");
          $(this).attr("selectit", "selectit")
          $(this).parents("tr.cartProductItemTR").css("background-color", "#FFF8E1");
          syncSelect();
          syncCreateOrderButton();
          getPrice();
        }
      });
      //点击全选选择框
      $("img.selectAllItem").click(function () {
        var selectit = $(this).attr("selectit");
        if ("selectit" == selectit) {
          $("img.selectAllItem").attr("src", "./images/cartNotSelected.png");
          $("img.selectAllItem").attr("selectit", "false")
          $("img.cartProductItemIfSelected").attr("src", "./images/cartNotSelected.png");
          $("img.cartProductItemIfSelected").attr("selectit", "false");
          $("img.cartProductItemIfSelected").parents("tr.cartProductItemTR").css("background-color", "#fff");
          removePrice();

        }
        else {
          $("img.selectAllItem").attr("src", "./images/cartSelected.png");
          $("img.selectAllItem").attr("selectit", "selectit");
          $("img.cartProductItemIfSelected").attr("src", "./images/cartSelected.png");
          $("img.cartProductItemIfSelected").attr("selectit", "selectit");
          $("img.cartProductItemIfSelected").parents("tr.cartProductItemTR").css("background-color", "#FFF8E1");
          getPrice();

        }
      });
      //键盘输入数量
      $(".orderItemNumberSetting").keyup(function () {
        var pid = $(this).attr("pid");
        var stock = $("span.orderItemStock[pid=" + pid + "]").text();
        var price = $("span.orderItemPromotePrice[pid=" + pid + "]").text();
        var num = $(".orderItemNumberSetting[pid=" + pid + "]").val();
        num = parseInt(num);
        if (isNaN(num)) {
          num = 1;
        }
        if (num <= 0)
          num = 1;
        if (num > stock)
          num = stock;
        $(".orderItemNumberSetting[pid=" + pid + "]").val(num);
        //改变金额
        price = convertNumber(price) * num;
        price = parseFloat(price).toFixed(2);
        $(".cartProductItemSmallSumPrice[pid=" + pid + "]").html("￥" + price);
        getPrice();
      });
      //点击+增加数量
      $(".numberPlus").click(function () {
        var pid = $(this).attr("pid");
        var stock = $("span.orderItemStock[pid=" + pid + "]").text();
        var price = $("span.orderItemPromotePrice[pid=" + pid + "]").text();
        var num = $(".orderItemNumberSetting[pid=" + pid + "]").val();
        ++num;
        $(".orderItemNumberSetting[pid=" + pid + "]").val(num);
        price = convertNumber(price) * num;
        price = parseFloat(price).toFixed(2);
        $(".cartProductItemSmallSumPrice[pid=" + pid + "]").html("￥" + price);
        getPrice();
      });
      //点击-减少数量 
      $(".numberMinus").click(function () {
        var pid = $(this).attr("pid");
        var stock = $("span.orderItemStock[pid=" + pid + "]").text();
        var price = $("span.orderItemPromotePrice[pid=" + pid + "]").text();
        var num = $(".orderItemNumberSetting[pid=" + pid + "]").val();
        --num;
        if (num == 0) num = 1;
        $(".orderItemNumberSetting[pid=" + pid + "]").val(num);
        price = convertNumber(price) * num;
        price = parseFloat(price).toFixed(2);
        $(".cartProductItemSmallSumPrice[pid=" + pid + "]").html("￥" + price);
        getPrice();
      })
    });
    //全选函数
    function syncSelect() {
      var selectAll = true;
      $(".cartProductItemIfSelected").each(function () {
        if ("false" == $(this).attr("selectit")) {
          selectAll = false;
        }
      });
      if (selectAll) {
        $("img.selectAllItem").attr("src", "./images/cartSelected.png");
      }

      else {
        $("img.selectAllItem").attr("src", "./images/cartNotSelected.png");
      }

    }

    function syncCreateOrderButton() {
      var selectAny = false;
      $(".cartProductItemIfSelected").each(function () {

        if ("selectit" == $(this).attr("selectit")) {
          selectAny = true;
        }
      });
      if (selectAny) {
        $("button.createOrderButton").css("background-color", "#C40000");
        $("button.createOrderButton").removeAttr("disabled");
      }
      else {
        $("button.createOrderButton").css("background-color", "#AAAAAA");
        $("button.createOrderButton").attr("disabled", "disabled");
      }
    }
    //获取产品金额
    function getPrice() {
      var price;
      var oiid;
      var sumPrice = 0;
      var sumNum = 0;
      $(".cartProductItemIfSelected").each(function () {
        if ("selectit" == $(this).attr("selectit")) {
          oiid = $(this).attr("oiid");
          pid = $(".orderItemNumberSetting[oiid=" + oiid + "]").attr("pid");
          num = $(".orderItemNumberSetting[pid=" + pid + "]").val();
          sumNum = parseInt(sumNum) + parseInt(num);
          if (isNaN(sumNum)) {
            sumNum = 1;
          }
          price = $(".cartProductItemSmallSumPrice[oiid=" + oiid + "]").text();
          price = convertNumber(price);
          sumPrice = parseFloat(sumPrice) + parseFloat(price);
          sumPrice = parseFloat(sumPrice).toFixed(2);
          creatSumPrice(sumPrice, sumNum);
        }
      })
    }

    function convertNumber(price) {
      price = price.replace(/\￥|\,/g, '');
      price = parseFloat(price).toFixed(2);
      return price;
    }
    //将计算后的金额数转化成页面展示的价格，也就是增加价格符号
    function creatSumPrice(sumPrice, sumMumber) {
      document.getElementById("cartSumPrice").innerHTML = "￥" + sumPrice;
      document.getElementById("cartTitlePrice").innerHTML = "￥" + sumPrice;
      document.getElementById("cartSumNumber").innerHTML = sumMumber;

    }
    //初始化价格
    function removePrice() {
      document.getElementById("cartSumPrice").innerHTML = "￥0.00";
      document.getElementById("cartTitlePrice").innerHTML = "￥0.00";
      document.getElementById("cartSumNumber").innerHTML = "0";
    }
  </script>

</body>

</html>